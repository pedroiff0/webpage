---
layout: default
---

{% include base_path %}

{% if page.header.overlay_color or page.header.overlay_image or page.header.image %}
  {% include page__hero.html %}
{% endif %}

{% if page.url != "/" and site.breadcrumbs %}
  {% unless paginator %}
    {% include breadcrumbs.html %}
  {% endunless %}
{% endif %}

<div id="main" role="main" style="display: flex; min-height: 70vh; width: 100%;">
  <aside class="sidebar-area" style="flex-basis: 25%; flex-shrink: 0; flex-grow: 0; min-width: 220px; max-width: 25%; background: none; height: 100vh; display: flex; align-items: stretch;">
    <div style="width: 100%; height: 100%;">
      {% include sidebar.html %}
    </div>
  </aside>

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork" style="flex-basis: 75%; flex-grow: 1; max-width: 75%; padding: 2rem 2rem 2rem 0; margin-left: 2rem;">
    {% if page.title %}<meta itemprop="headline" content="{{ page.title | markdownify | strip_html | strip_newlines | escape_once }}">{% endif %}
    {% if page.excerpt %}<meta itemprop="description" content="{{ page.excerpt | markdownify | strip_html | strip_newlines | escape_once }}">{% endif %}
    {% if page.date %}<meta itemprop="datePublished" content="{{ page.date | date: "%B %d, %Y" }}">{% endif %}
    {% if page.modified %}<meta itemprop="dateModified" content="{{ page.modified | date: "%B %d, %Y" }}">{% endif %}

    <div class="page__inner-wrap">
      {% unless page.header.overlay_color or page.header.overlay_image %}
        <header>
          {% if page.title %}
            {% if page.title.en %}
              <h1 class="page__title" itemprop="headline"><span class="lang-en">{{ page.title.en }}</span><span class="lang-pt">{{ page.title.pt }}</span></h1>
            {% else %}
              <h1 class="page__title" itemprop="headline">{{ page.title | markdownify | remove: "<p>" | remove: "</p>" }}</h1>
            {% endif %}
          {% endif %}
          {% if page.read_time %}
            <p class="page__meta"><i class="fa fa-clock" aria-hidden="true"></i> {% include read-time.html %}</p>
          {% endif %}
        {% if page.modified %}
          {% assign modified_en = page.modified | date: "%B %-d, %Y" %}
          {% assign modified_pt = page.modified | date: "%-d %B %Y" %}
          {% assign modified_pt = modified_pt | replace: 'January', 'janeiro' | replace: 'February', 'fevereiro' | replace: 'March', 'março' | replace: 'April', 'abril' | replace: 'May', 'maio' | replace: 'June', 'junho' | replace: 'July', 'julho' | replace: 'August', 'agosto' | replace: 'September', 'setembro' | replace: 'October', 'outubro' | replace: 'November', 'novembro' | replace: 'December', 'dezembro' %}
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <span class="lang-en">Published:</span><span class="lang-pt">Publicado em:</span></strong> <time datetime="{{ page.modified | date: "%Y-%m-%d" }}"><span class="lang-en">{{ modified_en }}</span><span class="lang-pt">{{ modified_pt }}</span></time></p>
        {% endif %}
        
        {% if page.collection == 'teaching' %}
          <p> {{ page.type }}, <i>{{ page.venue }}</i>, {{ page.date | default: "1900-01-01" | date: "%Y" }} </p>
        {% elsif page.venue and page.date %}
          <p><span class="lang-en">Published in</span><span class="lang-pt">Publicado em</span> <i>{{ page.venue }}</i>, {{ page.date | default: "1900-01-01" | date: "%Y" }} </p>
        {% elsif page.date %}
          {% assign published_en = page.date | default: "1900-01-01" | date: "%B %-d, %Y" %}
          {% assign published_pt = page.date | default: "1900-01-01" | date: "%-d %B %Y" %}
          {% assign published_pt = published_pt | replace: 'January', 'janeiro' | replace: 'February', 'fevereiro' | replace: 'March', 'março' | replace: 'April', 'abril' | replace: 'May', 'maio' | replace: 'June', 'junho' | replace: 'July', 'julho' | replace: 'August', 'agosto' | replace: 'September', 'setembro' | replace: 'October', 'outubro' | replace: 'November', 'novembro' | replace: 'December', 'dezembro' %}
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <span class="lang-en">Published:</span><span class="lang-pt">Publicado em:</span></strong> <time datetime="{{ page.date | date_to_xmlschema }}"><span class="lang-en">{{ published_en }}</span><span class="lang-pt">{{ published_pt }}</span></time></p>
        {% endif %}    
        </header>
      {% endunless %}

      <section class="page__content" itemprop="text">
        {{ content }}

        <div class="engagement" data-engagement>
          <div class="like-share">
            <button class="like-button" type="button" data-like-button data-page-id="{{ page.url | default: page.permalink | slugify }}">
              <i class="fas fa-heart" aria-hidden="true"></i>
              <span class="lang-en">Like</span><span class="lang-pt">Curtir</span>
              <span class="like-count" data-like-count>0</span>
            </button>

            <div class="share-buttons" data-share>
              <span class="share-label"><span class="lang-en">Share:</span><span class="lang-pt">Compartilhar:</span></span>
              {% assign full_url = site.url | append: page.url %}
              {% assign share_title = page.title.en | default: page.title | uri_escape %}
              <a class="share-btn share-twitter" href="https://twitter.com/intent/tweet?url={{ full_url | uri_escape }}&text={{ share_title }}" target="_blank" rel="noopener"><i class="fab fa-twitter" aria-hidden="true"></i> X</a>
              <a class="share-btn share-linkedin" href="https://www.linkedin.com/sharing/share-offsite/?url={{ full_url | uri_escape }}" target="_blank" rel="noopener"><i class="fab fa-linkedin" aria-hidden="true"></i> LinkedIn</a>
              <a class="share-btn share-whatsapp" href="https://api.whatsapp.com/send?text={{ share_title }}%20{{ full_url | uri_escape }}" target="_blank" rel="noopener"><i class="fab fa-whatsapp" aria-hidden="true"></i> WhatsApp</a>
              <button type="button" class="share-btn share-native" data-share-native><i class="fas fa-share-alt" aria-hidden="true"></i> <span class="lang-en">Share</span><span class="lang-pt">Compartilhar</span></button>
            </div>
          </div>

          <div class="comments" data-comments>
            <h3 class="comments__title"><span class="lang-en">Comments</span><span class="lang-pt">Comentários</span></h3>
            <form class="comments__form" data-comment-form>
              <div class="comments__fields">
                <input type="text" name="name" placeholder="Name / Nome (opcional)" />
                <input type="email" name="email" placeholder="Email (opcional)" />
              </div>
              <textarea name="message" placeholder="Mensagem / Message" required></textarea>
              <button type="submit" class="btn"> <span class="lang-en">Publish</span><span class="lang-pt">Publicar</span> </button>
              <p class="comments__note"><span class="lang-en">Comments stay on this device only.</span><span class="lang-pt">Comentários ficam apenas neste dispositivo.</span></p>
            </form>
            <div class="comments__list" data-comment-list></div>
          </div>
        </div>

        {% if page.citation %}
          <p style="font-size: smaller">
            <span class="lang-en">Recommended citation:</span><span class="lang-pt">Citação recomendada:</span>
            {% if page.citation.en %}
              <span class="lang-en">{{ page.citation.en }}</span><span class="lang-pt">{{ page.citation.pt }} Acesso em: {{ 'now' | date: '%d' }} {{ 'now' | date: '%B' | downcase | replace: 'january', 'jan.' | replace: 'february', 'fev.' | replace: 'march', 'mar.' | replace: 'april', 'abr.' | replace: 'may', 'maio' | replace: 'june', 'jun.' | replace: 'july', 'jul.' | replace: 'august', 'ago.' | replace: 'september', 'set.' | replace: 'october', 'out.' | replace: 'november', 'nov.' | replace: 'december', 'dez.' }} {{ 'now' | date: '%Y' }}.</span>
            {% else %}
              {{ page.citation }}
            {% endif %}
          </p>
        {% endif %}
        
        {% if page.paperurl or page.bibtexurl %}
          <p style="font-size: smaller">
            {% if page.paperurl %}
              <a href="{{ page.paperurl }}"><span class="lang-en">Download Paper</span><span class="lang-pt">Baixar Artigo</span></a>
            {% endif %}
            {% if page.paperurl and page.bibtexurl %} | {% endif %}
            {% if page.bibtexurl %}
              <a href="{{ page.bibtexurl }}"><span class="lang-en">Download BibTeX</span><span class="lang-pt">Baixar BibTeX</span></a>
            {% endif %}
          </p>
        {% endif %}

        {% if page.link %}<div><a href="{{ page.link }}" class="btn">{{ site.data.ui-text[site.locale].ext_link_label | default: "Direct Link" }}</a></div>{% endif %}
        {% if page.link %}
          <div>
            {% assign is_external = page.link | slice: 0, 4 %}
            {% if is_external == 'http' %}
              <a href="{{ page.link }}" class="btn">{{ site.data.ui-text[site.locale].ext_link_label | default: "Direct Link" }}</a>
            {% else %}
              <a href="{{ site.baseurl }}{{ page.link }}" class="btn">{{ site.data.ui-text[site.locale].ext_link_label | default: "Direct Link" }}</a>
            {% endif %}
          </div>
        {% endif %}
      </section>

      <footer class="page__meta">
        {% if site.data.ui-text[site.locale].meta_label %}
          <h4 class="page__meta-title">{{ site.data.ui-text[site.locale].meta_label }}</h4>
        {% endif %}
        {% include page__taxonomy.html %}
      </footer>

      {% if page.share %}{% include social-share.html %}{% endif %}

      {% include post_pagination.html %}
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const pageId = '{{ page.url | default: page.permalink | slugify }}';
        const fullUrl = '{{ site.url | append: page.url }}';

        // Likes (local only)
        const likeBtn = document.querySelector('[data-like-button]');
        const likeCountEl = document.querySelector('[data-like-count]');
        if (likeBtn && likeCountEl) {
          const likeKey = `like:${pageId}`;
          const likedKey = `${likeKey}:liked`;
          let count = parseInt(localStorage.getItem(likeKey) || '0', 10);
          let liked = localStorage.getItem(likedKey) === '1';

          const renderLike = () => {
            likeCountEl.textContent = count;
            likeBtn.classList.toggle('liked', liked);
          };

          likeBtn.addEventListener('click', () => {
            if (!liked) {
              liked = true;
              count += 1;
            } else {
              liked = false;
              count = Math.max(0, count - 1);
            }
            localStorage.setItem(likeKey, count.toString());
            localStorage.setItem(likedKey, liked ? '1' : '0');
            renderLike();
          });

          renderLike();
        }

        // Social sharing (native API fallback to links)
        const nativeShareBtn = document.querySelector('[data-share-native]');
        if (nativeShareBtn) {
          if (navigator.share) {
            nativeShareBtn.addEventListener('click', async () => {
              try {
                await navigator.share({ title: document.title, url: fullUrl });
              } catch (err) {
                // ignore cancel
              }
            });
          } else {
            nativeShareBtn.style.display = 'none';
          }
        }

        // Anonymous comments (localStorage per page)
        const commentForm = document.querySelector('[data-comment-form]');
        const commentList = document.querySelector('[data-comment-list]');
        const commentsKey = `comments:${pageId}`;

        const loadComments = () => {
          try { return JSON.parse(localStorage.getItem(commentsKey) || '[]'); }
          catch(e) { return []; }
        };
        let comments = loadComments();

        const deleteComment = (index) => {
          if (confirm(document.documentElement.lang === 'pt' ? 'Deseja realmente remover este comentário?' : 'Are you sure you want to delete this comment?')) {
            comments.splice(index, 1);
            localStorage.setItem(commentsKey, JSON.stringify(comments));
            renderComments();
          }
        };

        const toggleCommentLike = (index) => {
          if (!comments[index].likes) comments[index].likes = 0;
          if (!comments[index].likedBy) comments[index].likedBy = [];
          
          const userId = localStorage.getItem('user-id') || (() => {
            const id = 'u-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('user-id', id);
            return id;
          })();
          
          const likedIndex = comments[index].likedBy.indexOf(userId);
          if (likedIndex > -1) {
            comments[index].likedBy.splice(likedIndex, 1);
            comments[index].likes = Math.max(0, comments[index].likes - 1);
          } else {
            comments[index].likedBy.push(userId);
            comments[index].likes += 1;
          }
          
          localStorage.setItem(commentsKey, JSON.stringify(comments));
          renderComments();
        };

        const renderComments = () => {
          if (!commentList) return;
          if (!comments.length) {
            commentList.innerHTML = '<p class="comments__empty"><span class="lang-en">Be the first to comment.</span><span class="lang-pt">Seja o primeiro a comentar.</span></p>';
            return;
          }
          
          const userId = localStorage.getItem('user-id');
          
          commentList.innerHTML = comments.map((c, idx) => {
            const name = c.name || '<span class="lang-en">Anonymous</span><span class="lang-pt">Anônimo</span>';
            const time = c.timestamp ? new Date(c.timestamp).toLocaleString() : '';
            const likes = c.likes || 0;
            const isLiked = c.likedBy && userId && c.likedBy.includes(userId);
            
            return `<div class="comment">
              <div class="comment__head">
                <strong>${name}</strong>
                <div class="comment__meta">
                  <span class="comment__time">${time}</span>
                  <button class="comment__delete" data-delete-idx="${idx}" title="Delete">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </div>
              </div>
              <p>${c.message}</p>
              <div class="comment__actions">
                <button class="comment__like ${isLiked ? 'liked' : ''}" data-like-idx="${idx}">
                  <i class="fas fa-heart"></i>
                  <span class="lang-en">Like</span><span class="lang-pt">Curtir</span>
                  ${likes > 0 ? `<span class="comment__like-count">${likes}</span>` : ''}
                </button>
              </div>
            </div>`;
          }).join('');

          // Attach delete handlers
          commentList.querySelectorAll('[data-delete-idx]').forEach(btn => {
            btn.addEventListener('click', () => {
              deleteComment(parseInt(btn.dataset.deleteIdx, 10));
            });
          });
          
          // Attach like handlers
          commentList.querySelectorAll('[data-like-idx]').forEach(btn => {
            btn.addEventListener('click', () => {
              toggleCommentLike(parseInt(btn.dataset.likeIdx, 10));
            });
          });
        };

        if (commentForm) {
          commentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(commentForm);
            const message = (formData.get('message') || '').toString().trim();
            if (!message) return;
            const name = (formData.get('name') || '').toString().trim();
            const email = (formData.get('email') || '').toString().trim();
            comments.unshift({
              name: name || '',
              email: email || '',
              message,
              timestamp: new Date().toISOString(),
            });
            localStorage.setItem(commentsKey, JSON.stringify(comments.slice(0, 100)));
            commentForm.reset();
            renderComments();
          });
        }

        renderComments();
      });
    </script>

    {% if site.comments.provider and page.comments %}
      {% include comments.html %}
    {% endif %}
  </article>

  </article>
</div>

{% comment %}<!-- only show related on a post page when not disabled -->{% endcomment %}
{% if page.id and page.related and site.related_posts.size > 0 %}
  <div class="page__related" style="width: 100%; max-width: 1280px; margin: 2rem auto; padding: 0 2rem;">
    {% if site.data.ui-text[site.locale].related_label %}
      <h4 class="page__related-title">{{ site.data.ui-text[site.locale].related_label | default: "You May Also Enjoy" }}</h4>
    {% endif %}
    <div class="grid__wrapper">
      {% for post in site.related_posts limit:4 %}
        {% include archive-single.html type="grid" %}
      {% endfor %}
    </div>
  </div>
{% endif %}
