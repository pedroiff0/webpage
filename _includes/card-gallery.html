{% comment %}
Reusable card gallery for any collection.
Params:
- collection: required, e.g., site.posts or site.publications
- show_date: true/false (default true if date exists)
- show_excerpt: true/false (default true)
- show_tags: true/false (default true)
- excerpt_words: number of words to truncate when excerpt is a string (default 28)
- default_image: fallback image path (defaults to /images/profilepic.jpeg)
- sort_by: key to sort by (default: date)
- reverse: set to false to keep ascending order
- empty_message: message when collection is empty
{% endcomment %}
{% include base_path %}

{% assign items = include.collection | default: site.posts %}
{% assign sort_key = include.sort_by | default: 'date' %}
{% if items and sort_key %}
  {% assign items = items | sort: sort_key %}
  {% if include.reverse != false %}
    {% assign items = items | reverse %}
  {% endif %}
{% endif %}

<div class="card-grid">
  {% if items and items.size > 0 %}
    {% for item in items %}
      {% if item.title.en %}
        {% assign alt_title = item.title.en %}
      {% else %}
        {% assign alt_title = item.title %}
      {% endif %}

      {% assign teaser = item.header.teaser | default: include.default_image | default: '/images/profilepic.jpeg' %}
      {% if teaser contains '://' %}
        {% assign teaser_src = teaser %}
      {% else %}
        {% assign teaser_src = teaser | prepend: base_path %}
      {% endif %}

      <a href="{{ item.url | prepend: base_path }}" class="card">
        {% if teaser %}
          <img src="{{ teaser_src }}" alt="{{ alt_title }}" class="card-image">
        {% endif %}
        <div class="card-body">
          <h3 class="card-title">
            {% include bilingual-title.html title=item.title %}
          </h3>
            {% assign desc = nil %}
            {% if item.summary %}
              {% assign desc = item.summary %}
            {% elsif item.excerpt %}
              {% assign desc = item.excerpt %}
            {% endif %}
          {% if include.show_date != false and item.date %}
            <div class="card-meta">
              {% assign date_en = item.date | date: "%B %-d, %Y" %}
              {% assign date_pt = item.date | date: "%-d %B %Y" %}
              {% assign date_pt = date_pt | replace: 'January', 'janeiro' | replace: 'February', 'fevereiro' | replace: 'March', 'mar√ßo' | replace: 'April', 'abril' | replace: 'May', 'maio' | replace: 'June', 'junho' | replace: 'July', 'julho' | replace: 'August', 'agosto' | replace: 'September', 'setembro' | replace: 'October', 'outubro' | replace: 'November', 'novembro' | replace: 'December', 'dezembro' %}
              <span class="lang-en">{{ date_en }}</span>
              <span class="lang-pt">{{ date_pt }}</span>
            </div>
          {% endif %}
            {% if include.show_excerpt != false and desc %}
              {% assign excerpt_words = include.excerpt_words | default: 28 %}
              <p class="card-excerpt">
                {% include bilingual-excerpt.html excerpt=desc words=excerpt_words %}
              </p>
            {% endif %}
          {% if include.show_tags != false and item.tags %}
          <div class="card-tags">
            {% for tag in item.tags limit:3 %}
            {% assign tag_key = tag | slugify %}
            <span class="card-tag">
              <span class="lang-en">{{ site.data.tags[tag_key].en | default: tag }}</span>
              <span class="lang-pt">{{ site.data.tags[tag_key].pt | default: tag }}</span>
            </span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </a>
    {% endfor %}
  {% else %}
    <div class="card-empty">{{ include.empty_message | default: "No entries yet. Check back soon!" }}</div>
  {% endif %}
</div>
